<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rental Contracts - Admin</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: #1e293b;
      color: white;
      padding: 20px;
      box-shadow: 4px 0 10px rgba(0,0,0,0.1);
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 40px;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-menu {
      list-style: none;
    }

    .nav-menu li {
      margin-bottom: 10px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      color: #94a3b8;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-link:hover,
    .nav-link.active {
      background: rgba(102, 126, 234, 0.2);
      color: white;
    }

    .nav-icon {
      margin-right: 12px;
      font-size: 18px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .header {
      background: white;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
      color: #2d3748;
      margin-bottom: 5px;
    }

    .header p {
      color: #64748b;
      font-size: 14px;
    }

    /* Notification Banner */
    .notification-banner {
      display: none;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .notification-banner.show {
      display: block;
    }

    .notification-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .notification-icon {
      font-size: 32px;
    }

    .notification-text h3 {
      margin-bottom: 5px;
      font-size: 18px;
    }

    .notification-text p {
      font-size: 14px;
      opacity: 0.9;
    }

    .notification-list {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .notification-item {
      padding: 10px 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }

    .stat-icon.blue {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .stat-icon.green {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .stat-icon.orange {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }

    .stat-icon.red {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }

    .stat-content h3 {
      font-size: 32px;
      font-weight: bold;
      color: #1e293b;
    }

    .stat-content p {
      color: #64748b;
      font-size: 14px;
    }

    /* Contract List */
    .card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      margin-bottom: 25px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f1f5f9;
    }

    .card-header h2 {
      font-size: 20px;
      color: #1e293b;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #f1f5f9;
      color: #64748b;
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-sm {
      padding: 6px 14px;
      font-size: 12px;
    }

    /* Table */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f8fafc;
    }

    th {
      padding: 12px;
      text-align: left;
      font-size: 11px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f1f5f9;
      color: #1e293b;
      font-size: 13px;
    }

    tbody tr:hover {
      background: #f8fafc;
    }

    tbody tr.terminated {
      opacity: 0.6;
      background: #fee2e2;
    }

    .tenant-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tenant-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      display: inline-block;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    .status-active {
      background: #d1fae5;
      color: #065f46;
    }

    .status-terminated {
      background: #fee2e2;
      color: #991b1b;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #94a3b8;
    }

    .empty-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 40px;
      position: relative;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid #667eea;
    }

    .modal-header h2 {
      font-size: 28px;
      color: #1e293b;
      margin-bottom: 10px;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #f1f5f9;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      color: #64748b;
      transition: all 0.3s;
    }

    .modal-close:hover {
      background: #e2e8f0;
      transform: rotate(90deg);
    }

    .contract-section {
      margin-bottom: 30px;
    }

    .contract-section h3 {
      color: #1e293b;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .info-item {
      background: #f8fafc;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .info-label {
      color: #64748b;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .info-value {
      color: #1e293b;
      font-size: 14px;
      font-weight: 600;
    }

    .agreement-box {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .termination-box {
      background: #fee2e2;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 2px solid #ef4444;
    }

    .modal-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #f1f5f9;
    }

    .termination-reason {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-family: inherit;
      font-size: 14px;
      margin-top: 10px;
      resize: vertical;
      min-height: 80px;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
        padding: 20px 10px;
      }

      .nav-link span:not(.nav-icon) {
        display: none;
      }

      .nav-link {
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .modal-content {
        padding: 20px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">RENTARIUM</div>
      <nav>
        <ul class="nav-menu">
          <li><a href="../ADMIN/Admin-Dashboard.html" class="nav-link"><span class="nav-icon">üìä</span><span>Dashboard</span></a></li>
          <li><a href="../ADMIN/Unit-Management.html" class="nav-link"><span class="nav-icon">üè¢</span><span>Units Management</span></a></li>
          <li><a href="../ADMIN/Tenants-Section.html" class="nav-link"><span class="nav-icon">üë•</span><span>Tenants Management</span></a></li>
          <li><a href="../ADMIN/CreateTenantAccount.html" class="nav-link"><span class="nav-icon">üë§</span><span>Create Tenant Account</span></a></li>
          <li><a href="../ADMIN/Payments-Section.html" class="nav-link"><span class="nav-icon">üí≥</span><span>Payments</span></a></li>
          <li><a href="../ADMIN/Announcements-Section.html" class="nav-link"><span class="nav-icon">üì¢</span><span>Announcements</span></a></li>
          <li><a href="../ADMIN/Rental-Contract-Admin.html" class="nav-link active"><span class="nav-icon">üìù</span><span>Contracts</span></a></li>
          <li><a href="../Users/Login-Form.html" class="nav-link"><span class="nav-icon">‚û°Ô∏è</span><span>Logout</span></a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <h1>Rental Contracts Management</h1>
        <p>Generate and monitor rental agreements for all tenants</p>
      </header>

      <!-- Notification Banner -->
      <div class="notification-banner" id="notificationBanner">
        <div class="notification-content">
          <div class="notification-icon">üéâ</div>
          <div class="notification-text">
            <h3>New Contract Agreements!</h3>
            <p id="notificationSummary">Tenants have agreed to rental contracts</p>
          </div>
        </div>
        <div class="notification-list" id="notificationList"></div>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon blue">üìù</div>
          <div class="stat-content">
            <h3 id="totalContracts">0</h3>
            <p>Total Contracts</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon green">‚úì</div>
          <div class="stat-content">
            <h3 id="activeContracts">0</h3>
            <p>Active Contracts</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon orange">‚è≥</div>
          <div class="stat-content">
            <h3 id="pendingContracts">0</h3>
            <p>Pending Review</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon red">‚ùå</div>
          <div class="stat-content">
            <h3 id="terminatedContracts">0</h3>
            <p>Terminated</p>
          </div>
        </div>
      </div>

      <!-- Contracts List -->
      <div class="card">
        <div class="card-header">
          <h2>All Contracts</h2>
          <button class="btn btn-primary" onclick="generateAllContracts()">Generate All Contracts</button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>TENANT</th>
                <th>UNIT</th>
                <th>RENT</th>
                <th>LEASE PERIOD</th>
                <th>STATUS</th>
                <th>AGREED DATE</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="contractsTableBody">
              <tr>
                <td colspan="7" class="empty-state">
                  <div class="empty-icon">üìÑ</div>
                  <p>No contracts found</p>
                  <button class="btn btn-primary" onclick="generateAllContracts()" style="margin-top: 15px;">Generate Contracts</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Contract Modal -->
  <div class="modal" id="contractModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      
      <div class="modal-header">
        <h2>RESIDENTIAL LEASE AGREEMENT</h2>
        <p>Rentarium Property Management</p>
      </div>

      <div class="contract-section">
        <h3>üìã Lease Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Tenant Name</div>
            <div class="info-value" id="modalTenantName">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Unit Number</div>
            <div class="info-value" id="modalUnit">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Monthly Rent</div>
            <div class="info-value" id="modalRent">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Lease Start</div>
            <div class="info-value" id="modalLeaseStart">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Lease End</div>
            <div class="info-value" id="modalLeaseEnd">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="modalEmail">-</div>
          </div>
        </div>
      </div>

      <div class="contract-section">
        <h3>‚úçÔ∏è Agreement Status</h3>
        
        <div class="agreement-box" id="agreementInfo">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <h4 style="color: #1e293b; margin-bottom: 5px;" id="modalStatusTitle">Tenant Agreement</h4>
              <p style="color: #64748b; font-size: 13px;" id="modalStatusText">-</p>
            </div>
            <span class="status-badge" id="modalStatusBadge">Pending</span>
          </div>
        </div>

        <div id="terminationInfo" style="display: none;">
          <div class="termination-box">
            <h4 style="color: #991b1b; margin-bottom: 10px;">‚ö†Ô∏è Contract Terminated</h4>
            <p style="color: #7f1d1d; font-size: 13px; margin-bottom: 10px;">
              <strong>Terminated by:</strong> <span id="terminatedBy">-</span><br>
              <strong>Termination date:</strong> <span id="terminationDate">-</span>
            </p>
            <p style="color: #7f1d1d; font-size: 13px;">
              <strong>Reason:</strong> <span id="terminationReason">-</span>
            </p>
          </div>
        </div>
      </div>

      <div class="modal-actions" id="modalActions">
        <button class="btn btn-danger" id="terminateBtn" onclick="showTerminationForm()">Terminate Contract</button>
        <button class="btn btn-secondary" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Termination Modal -->
  <div class="modal" id="terminationModal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" onclick="closeTerminationModal()">√ó</button>
      
      <div class="modal-header">
        <h2>‚ö†Ô∏è Terminate Contract</h2>
        <p>This action cannot be undone</p>
      </div>

      <div style="padding: 20px;">
        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f59e0b;">
          <p style="color: #92400e; font-size: 14px;">
            <strong>Warning:</strong> Terminating this contract will end the rental agreement immediately. The tenant will be notified of this action.
          </p>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; color: #1e293b; font-weight: 600;">
            Reason for Termination <span style="color: #ef4444;">*</span>
          </label>
          <textarea 
            id="terminationReasonInput" 
            class="termination-reason" 
            placeholder="Please provide a detailed reason for terminating this contract..."
            required
          ></textarea>
        </div>

        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <p style="color: #64748b; font-size: 13px; line-height: 1.6;">
            <strong>Contract Details:</strong><br>
            Tenant: <span id="termModalTenant">-</span><br>
            Unit: <span id="termModalUnit">-</span><br>
            Monthly Rent: <span id="termModalRent">-</span>
          </p>
        </div>

        <div class="modal-actions">
          <button class="btn btn-danger" onclick="confirmTermination()">
            Confirm Termination
          </button>
          <button class="btn btn-secondary" onclick="closeTerminationModal()">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentContractUsername = null;

    function getInitials(name) {
      if (!name) return 'TN';
      const names = name.trim().split(' ');
      if (names.length >= 2) {
        return (names[0][0] + names[names.length - 1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { 
        month: 'short',
        day: 'numeric', 
        year: 'numeric' 
      });
    }

    function formatCurrency(amount) {
      return '‚Ç±' + Number(amount).toLocaleString('en-US');
    }

    function generateAllContracts() {
      const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
      const contracts = JSON.parse(localStorage.getItem('rental_contracts')) || {};

      if (tenants.length === 0) {
        alert('No tenants found. Please add tenants first.');
        return;
      }

      let newCount = 0;
      tenants.forEach(tenant => {
        if (!contracts[tenant.username]) {
          contracts[tenant.username] = {
            tenantUsername: tenant.username,
            tenantName: tenant.name,
            unitNumber: tenant.unitAssigned,
            rentAmount: tenant.rentAmount,
            leaseStart: tenant.leaseStart,
            leaseEnd: tenant.leaseEnd,
            email: tenant.email,
            agreed: false,
            agreedDate: null,
            terminated: false,
            terminatedBy: null,
            terminatedDate: null,
            terminationReason: null,
            createdAt: new Date().toISOString()
          };
          newCount++;
        }
      });

      localStorage.setItem('rental_contracts', JSON.stringify(contracts));
      
      if (newCount > 0) {
        alert(`‚úì Generated ${newCount} new contract(s)! Tenants can now view and agree to their contracts.`);
      } else {
        alert('All tenants already have contracts.');
      }
      
      loadContracts();
    }

    function loadContracts() {
      const contracts = JSON.parse(localStorage.getItem('rental_contracts')) || {};
      const tbody = document.getElementById('contractsTableBody');

      const contractsArray = Object.values(contracts);

      // Update stats
      const total = contractsArray.length;
      const active = contractsArray.filter(c => c.agreed && !c.terminated).length;
      const pending = contractsArray.filter(c => !c.agreed && !c.terminated).length;
      const terminated = contractsArray.filter(c => c.terminated).length;

      document.getElementById('totalContracts').textContent = total;
      document.getElementById('activeContracts').textContent = active;
      document.getElementById('pendingContracts').textContent = pending;
      document.getElementById('terminatedContracts').textContent = terminated;

      // Check for notifications
      checkNotifications();

      if (contractsArray.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="empty-state">
              <div class="empty-icon">üìÑ</div>
              <p>No contracts found</p>
              <button class="btn btn-primary" onclick="generateAllContracts()" style="margin-top: 15px;">Generate Contracts</button>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = contractsArray.map(contract => {
        let status = 'Pending';
        let statusClass = 'status-pending';
        let rowClass = '';

        if (contract.terminated) {
          status = 'Terminated';
          statusClass = 'status-terminated';
          rowClass = 'terminated';
        } else if (contract.agreed) {
          status = 'Active';
          statusClass = 'status-active';
          rowClass = 'background: #f0fdf4;';
        }

        return `
          <tr style="${rowClass}" class="${contract.terminated ? 'terminated' : ''}">
            <td>
              <div class="tenant-info">
                <div class="tenant-avatar">${getInitials(contract.tenantName)}</div>
                <div>
                  <div style="font-weight: 600;">${contract.tenantName}</div>
                  <div style="font-size: 11px; color: #94a3b8;">${contract.email || ''}</div>
                </div>
              </div>
            </td>
            <td style="font-weight: 600;">${contract.unitNumber}</td>
            <td style="font-weight: 600;">${formatCurrency(contract.rentAmount)}</td>
            <td>${formatDate(contract.leaseStart)} - ${formatDate(contract.leaseEnd)}</td>
            <td><span class="status-badge ${statusClass}">${status}</span></td>
            <td>${contract.agreed ? formatDate(contract.agreedDate) : '-'}</td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="viewContract('${contract.tenantUsername}')">View</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function checkNotifications() {
      const notifications = JSON.parse(localStorage.getItem('contract_notifications')) || [];
      const unread = notifications.filter(n => !n.read);

      const banner = document.getElementById('notificationBanner');
      const summary = document.getElementById('notificationSummary');
      const list = document.getElementById('notificationList');

      if (unread.length > 0) {
        banner.classList.add('show');
        
        if (unread.length === 1) {
          summary.textContent = `${unread[0].tenantName} has agreed to the rental contract!`;
        } else {
          summary.textContent = `${unread.length} tenants have agreed to rental contracts!`;
        }

        list.innerHTML = unread.map(notif => `
          <div class="notification-item">
            ‚úì ${notif.message}
          </div>
        `).join('');

        setTimeout(() => {
          const allNotifications = JSON.parse(localStorage.getItem('contract_notifications')) || [];
          allNotifications.forEach(n => n.read = true);
          localStorage.setItem('contract_notifications', JSON.stringify(allNotifications));
        }, 3000);
      } else {
        banner.classList.remove('show');
      }
    }

    function viewContract(username) {
      currentContractUsername = username;
      const contracts = JSON.parse(localStorage.getItem('rental_contracts')) || {};
      const contract = contracts[username];

      if (!contract) {
        alert('Contract not found');
        return;
      }

      document.getElementById('modalTenantName').textContent = contract.tenantName;
      document.getElementById('modalUnit').textContent = contract.unitNumber;
      document.getElementById('modalRent').textContent = formatCurrency(contract.rentAmount);
      document.getElementById('modalLeaseStart').textContent = formatDate(contract.leaseStart);
      document.getElementById('modalLeaseEnd').textContent = formatDate(contract.leaseEnd);
      document.getElementById('modalEmail').textContent = contract.email || 'N/A';

      const statusBadge = document.getElementById('modalStatusBadge');
      const statusText = document.getElementById('modalStatusText');
      const terminateBtn = document.getElementById('terminateBtn');
      const terminationInfo = document.getElementById('terminationInfo');

      if (contract.terminated) {
        statusBadge.textContent = '‚ùå Terminated';
        statusBadge.className = 'status-badge status-terminated';
        statusText.textContent = `Contract terminated on ${formatDate(contract.terminatedDate)}`;
        document.getElementById('agreementInfo').style.background = '#fee2e2';
        terminateBtn.style.display = 'none';
        
        terminationInfo.style.display = 'block';
        document.getElementById('terminatedBy').textContent = contract.terminatedBy || 'N/A';
        document.getElementById('terminationDate').textContent = formatDate(contract.terminatedDate);
        document.getElementById('terminationReason').textContent = contract.terminationReason || 'No reason provided';
      } else if (contract.agreed) {
        statusBadge.textContent = '‚úì Active';
        statusBadge.className = 'status-badge status-active';
        statusText.textContent = `Tenant agreed on ${formatDate(contract.agreedDate)}`;
        document.getElementById('agreementInfo').style.background = '#d1fae5';
        terminateBtn.style.display = 'inline-block';
        terminationInfo.style.display = 'none';
      } else {
        statusBadge.textContent = 'Pending';
        statusBadge.className = 'status-badge status-pending';
        statusText.textContent = 'Waiting for tenant to review and agree';
        document.getElementById('agreementInfo').style.background = '#f8fafc';
        terminateBtn.style.display = 'none';
        terminationInfo.style.display = 'none';
      }

      document.getElementById('contractModal').classList.add('active');
    }

    

    function showTerminationForm() {
      const contracts = JSON.parse(localStorage.getItem('rental_contracts')) || {};
      const contract = contracts[currentContractUsername];

      if (!contract) return;

      document.getElementById('termModalTenant').textContent = contract.tenantName;
      document.getElementById('termModalUnit').textContent = contract.unitNumber;
      document.getElementById('termModalRent').textContent = formatCurrency(contract.rentAmount);
      document.getElementById('terminationReasonInput').value = '';

      document.getElementById('terminationModal').classList.add('active');
    }

    function confirmTermination() {
      const reason = document.getElementById('terminationReasonInput').value.trim();

      if (!reason) {
        alert('Please provide a reason for termination.');
        return;
      }

      if (!confirm('Are you sure you want to terminate this contract? This action cannot be undone.')) {
        return;
      }

      const contracts = JSON.parse(localStorage.getItem('rental_contracts')) || {};
      
      if (contracts[currentContractUsername]) {
        contracts[currentContractUsername].terminated = true;
        contracts[currentContractUsername].terminatedBy = 'Admin';
        contracts[currentContractUsername].terminatedDate = new Date().toISOString();
        contracts[currentContractUsername].terminationReason = reason;

        localStorage.setItem('rental_contracts', JSON.stringify(contracts));

        const notifications = JSON.parse(localStorage.getItem('termination_notifications')) || [];
        notifications.push({
          id: Date.now(),
          tenantUsername: currentContractUsername,
          tenantName: contracts[currentContractUsername].tenantName,
          unitNumber: contracts[currentContractUsername].unitNumber,
          terminatedBy: 'Admin',
          reason: reason,
          timestamp: new Date().toISOString(),
          read: false
        });
        localStorage.setItem('termination_notifications', JSON.stringify(notifications));

        alert('‚úì Contract terminated successfully. The tenant will be notified.');
        closeTerminationModal();
        closeModal();
        loadContracts();
      }
    }

    function closeModal() {
      document.getElementById('contractModal').classList.remove('active');
      currentContractUsername = null;
    }

    function closeTerminationModal() {
      document.getElementById('terminationModal').classList.remove('active');
    }

    document.getElementById('contractModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    document.getElementById('terminationModal').addEventListener('click', function(e) {
      if (e.target === this) closeTerminationModal();
    });

    document.addEventListener('DOMContentLoaded', () => {
      const session = localStorage.getItem('rentarium_session');
      if (!session) {
        window.location.href = '../Users/Login-Form.html';
        return;
      }

      const user = JSON.parse(session);
      if (user.role !== 'admin' && user.role !== 'landlord') {
        alert('Access denied. Admin privileges required.');
        window.location.href = '../Users/Login-Form.html';
        return;
      }

      loadContracts();
      setInterval(loadContracts, 5000);
    });

    document.querySelectorAll('a[href*="Login-Form.html"]').forEach(link => {
      if (link.textContent.toLowerCase().includes('logout') || link.textContent.includes('‚û°Ô∏è')) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          if (confirm('Are you sure you want to logout?')) {
            localStorage.removeItem('rentarium_session');
            window.location.href = '../Users/Login-Form.html';
          }
        });
      }
    });
  </script>
</body>
</html>