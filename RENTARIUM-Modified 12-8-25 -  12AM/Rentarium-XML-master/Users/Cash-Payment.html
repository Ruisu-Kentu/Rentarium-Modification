<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Payment Slip - Rentarium</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .slip-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
        }

        .slip-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .slip-logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .slip-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }

        .slip-subtitle {
            font-size: 14px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .slip-body {
            padding: 40px;
        }

        .slip-notice {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .notice-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notice-text {
            color: #78350f;
            font-size: 14px;
            line-height: 1.6;
        }

        .slip-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px dashed #cbd5e0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 15px;
            color: #1e293b;
            font-weight: 700;
        }

        .payment-type-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
        }

        .bill-breakdown-box {
            background: #f0f9ff;
            border-left: 3px solid #0ea5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .bill-breakdown-title {
            font-size: 11px;
            color: #075985;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .bill-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
            color: #0c4a6e;
        }

        .bill-item:last-child {
            margin-bottom: 0;
        }

        .amount-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 30px 0;
            border: 2px dashed #667eea;
        }

        .amount-label {
            font-size: 14px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .amount-value {
            font-size: 56px;
            color: #667eea;
            font-weight: 700;
            line-height: 1;
        }

        .reference-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 30px 0;
        }

        .reference-label {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .reference-value {
            font-size: 24px;
            color: #1e293b;
            font-weight: 700;
            letter-spacing: 3px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px dashed #cbd5e0;
        }

        .instructions {
            background: #ecfdf5;
            border-left: 4px solid #10b981;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
        }

        .instructions-title {
            font-weight: 700;
            color: #065f46;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .instructions-list {
            color: #047857;
            font-size: 13px;
            line-height: 1.8;
            padding-left: 20px;
        }

        .instructions-list li {
            margin-bottom: 8px;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-print {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-print:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .footer-note {
            text-align: center;
            color: #94a3b8;
            font-size: 11px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px dashed #e2e8f0;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            background: #fef3c7;
            color: #92400e;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media print {
            body {
                background: white;
            }
            .slip-container {
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }
            .btn-group {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="slip-container">
        <div class="slip-header">
            <div class="slip-logo">üíµ</div>
            <div class="slip-title">RENTARIUM</div>
            <div class="slip-subtitle">Cash Payment Slip</div>
        </div>

        <div class="slip-body">
            <div class="slip-notice">
                <div class="notice-title">
                    <span>‚ö†Ô∏è</span>
                    <span>AWAITING CASH PAYMENT</span>
                </div>
                <div class="notice-text">
                    This is an official payment slip for cash payment. Please present this slip when making your payment to the landlord or authorized staff. 
                    Your payment will be marked as complete once the landlord verifies receipt of cash.
                </div>
            </div>

            <div class="slip-section">
                <div class="section-title">Payment Information</div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Payment ID</div>
                        <div class="info-value" id="paymentId">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Generated Date</div>
                        <div class="info-value" id="generatedDate">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Payment Type</div>
                        <span class="payment-type-badge" id="paymentType">-</span>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Payment Status</div>
                        <span class="status-badge">Pending</span>
                    </div>
                </div>
                <div id="billBreakdownContainer" style="display: none;">
                    <div class="bill-breakdown-box">
                        <div class="bill-breakdown-title">Bill Breakdown</div>
                        <div id="billBreakdown"></div>
                    </div>
                </div>
            </div>

            <div class="slip-section">
                <div class="section-title">Tenant Details</div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Tenant Name</div>
                        <div class="info-value" id="tenantName">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Unit Number</div>
                        <div class="info-value" id="unitNumber">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Due Date</div>
                        <div class="info-value" id="dueDate">-</div>
                    </div>
                </div>
            </div>

            <div class="amount-section">
                <div class="amount-label">Amount to Pay</div>
                <div class="amount-value" id="amountValue">‚Ç±0</div>
            </div>

            <div class="reference-section">
                <div class="reference-label">Reference Number</div>
                <div class="reference-value" id="referenceNumber">-</div>
            </div>

            <div class="instructions">
                <div class="instructions-title">üìã Payment Instructions</div>
                <ol class="instructions-list">
                    <li>Prepare the exact amount shown above</li>
                    <li>Present this slip to your landlord or authorized staff</li>
                    <li>Keep this slip as proof of payment intention</li>
                    <li>Request an official receipt after payment</li>
                    <li>Payment status will be updated once verified by landlord</li>
                </ol>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="backToPayments()">Back to Payments</button>
                <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print Slip</button>
            </div>

            <div class="footer-note">
                This is a computer-generated slip. No signature required.<br>
                For inquiries, contact your property manager.
            </div>
        </div>
    </div>

         <script src="../js/full-payment-function.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const paymentId = urlParams.get('paymentId');

        if (paymentId) {
            // SIMPLE FIX: Get payment directly from localStorage
            const allPayments = JSON.parse(localStorage.getItem('rentarium_payments')) || [];
            const payment = allPayments.find(p => p.id === paymentId);
            
            if (payment) {
                // Debug: Show what's in the payment
                console.log("PAYMENT OBJECT:", payment);
                
                document.getElementById('paymentId').textContent = payment.id;
                document.getElementById('generatedDate').textContent = formatDateTime(payment.submittedDate || new Date().toISOString());
                
                // ULTIMATE SIMPLE FIX: Look for ANY sign it's a utility bill
                let paymentTypeText = 'Monthly Rent'; // Default
                
                // Check if it has ANY utility-related properties
                const hasBillDetails = payment.billDetails && payment.billDetails.trim() !== '';
                const hasBillId = payment.billId;
                const hasPaymentType = payment.paymentType && payment.paymentType.includes('Utility');
                const hasPayment_type = payment.payment_type === 'bill';
                const hasUtilityInDescription = payment.description && payment.description.toLowerCase().includes('utility');
                const hasUtilityInNotes = payment.notes && payment.notes.toLowerCase().includes('utility');
                
                // If ANY of these are true, show "Utility Bills"
                if (hasBillDetails || hasBillId || hasPaymentType || hasPayment_type || hasUtilityInDescription || hasUtilityInNotes) {
                    paymentTypeText = 'Utility Bills';
                    console.log("Setting to Utility Bills because:", {
                        hasBillDetails: hasBillDetails,
                        billDetails: payment.billDetails,
                        hasBillId: hasBillId,
                        hasPaymentType: hasPaymentType,
                        paymentType: payment.paymentType,
                        hasPayment_type: hasPayment_type,
                        payment_type: payment.payment_type
                    });
                }
                
                document.getElementById('paymentType').textContent = paymentTypeText;
                document.getElementById('tenantName').textContent = payment.tenantName || 'Tenant';
                document.getElementById('unitNumber').textContent = payment.unitNumber || 'Unit';
                document.getElementById('dueDate').textContent = formatDate(payment.dueDate || new Date().toISOString());
                document.getElementById('amountValue').textContent = `‚Ç±${(payment.amount || 0).toLocaleString()}`;
                document.getElementById('referenceNumber').textContent = payment.reference || payment.id;

                // Show bill breakdown if it's utility
                if (paymentTypeText === 'Utility Bills') {
                    document.getElementById('billBreakdownContainer').style.display = 'block';
                    
                    if (payment.billDetails && payment.billDetails.trim() !== '') {
                        const billsArray = payment.billDetails.split(', ');
                        document.getElementById('billBreakdown').innerHTML = billsArray.map(bill => {
                            const [label, value] = bill.split(': ');
                            return `<div class="bill-item"><span>${label}:</span><strong>‚Ç±${value}</strong></div>`;
                        }).join('');
                    } else {
                        document.getElementById('billBreakdown').innerHTML = `
                            <div class="bill-item"><span>Utility Payment:</span><strong>‚Ç±${payment.amount.toLocaleString()}</strong></div>
                        `;
                    }
                }
                
            } else {
                alert('Payment record not found');
                window.location.href = 'User-Payment.html';
            }
        } else {
            alert('Invalid payment slip');
            window.location.href = 'User-Payment.html';
        }

        function backToPayments() {
            window.location.href = 'User-Payment.html';
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatDateTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html>