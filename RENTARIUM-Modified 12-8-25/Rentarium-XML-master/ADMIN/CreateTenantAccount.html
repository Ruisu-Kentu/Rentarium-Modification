<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/create-tenant.css">
    <title>Create Tenant Account - Rentarium</title>
</head>
<body>
   <div class="dashboard-container">
    <aside class="sidebar">
      <div class="logo">RENTARIUM</div>
      <nav>
         <ul class="nav-menu">
           <li><a href="Admin-Dashboard.html" class="nav-link"><span class="nav-icon">üìä</span><span>Dashboard</span></a></li>
          <li><a href="Unit-Management.html" class="nav-link"><span class="nav-icon">üè¢</span><span>Units Management</span></a></li>
          <li><a href="Tenants-Section.html" class="nav-link"><span class="nav-icon">üë•</span><span>Tenants Management</span></a></li>
          <li><a href="CreateTenantAccount.html" class="nav-link active"><span class="nav-icon">üë§</span><span>Create Tenant Account</span></a></li>
          <li><a href="Payments-Section.html" class="nav-link"><span class="nav-icon">üí≥</span><span>Payments</span></a></li>
          <li><a href="Announcements-Section.html" class="nav-link"><span class="nav-icon">üì¢</span><span>Announcements</span></a></li>
          <li><a href="../Users/Login-Form.html" class="nav-link"><span class="nav-icon">üö™</span><span>Logout</span></a></li>
        </ul>
      </nav>
    </aside>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <h2>Create Tenant Account</h2>
                <p>Set up a new tenant account with login credentials to access their dashboard</p>
            </header>

            <!-- Form Container -->
            <div class="form-container">
                <!-- Success/Error Messages -->
                <div class="success-message" id="successMessage">
                    <span>‚úì</span>
                    <span>Tenant account created successfully!</span>
                </div>
                <div class="error-message" id="errorMessage">
                    <span>‚ö†</span>
                    <span>Please fix the errors below and try again.</span>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <p><strong>üìå Note:</strong> The tenant will use these credentials to log in to their dashboard. Make sure to provide 
                        them with their username and password after account creation.</p>
                </div>

                <form id="tenantAccountForm">
                    <!-- Personal Information -->
                    <div class="form-section">
                        <h3 class="section-title">Personal Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="firstName">First Name <span class="required">*</span></label>
                                <input type="text" id="firstName" name="firstName" required>
                                <span class="error-text">Please enter first name</span>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Last Name <span class="required">*</span></label>
                                <input type="text" id="lastName" name="lastName" required>
                                <span class="error-text">Please enter last name</span>
                            </div>
                            <div class="form-group">
                                <label for="email">Email Address <span class="required">*</span></label>
                                <input type="email" id="email" name="email" required>
                                <span class="error-text">Please enter a valid email</span>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number <span class="required">*</span></label>
                                <input type="tel" id="phone" name="phone" placeholder="09XX-XXX-XXXX" required>
                                <span class="error-text">Please enter a valid phone number</span>
                            </div>
                        </div>
                    </div>

                    <!-- Account Credentials -->
                    <div class="form-section">
                        <h3 class="section-title">Account Credentials</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="username">Username <span class="required">*</span></label>
                                <input type="text" id="username" name="username" required>
                                <span class="error-text">Username must be at least 4 characters</span>
                            </div>
                            <div class="form-group">
                                <label for="password">Password <span class="required">*</span></label>
                                <input type="password" id="password" name="password" required>
                                <div class="password-strength" id="passwordStrength">
                                    <div class="password-strength-bar"></div>
                                </div>
                                <p class="password-hint">Minimum 8 characters with uppercase, lowercase, and number</p>
                                <span class="error-text">Password must meet requirements</span>
                            </div>
                            <div class="form-group">
                                <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
                                <input type="password" id="confirmPassword" name="confirmPassword" required>
                                <span class="error-text">Passwords do not match</span>
                            </div>
                        </div>
                    </div>

                    <!-- Unit Assignment -->
                    <div class="form-section">
                        <h3 class="section-title">Unit Assignment</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="unitNumber">Assigned Unit <span class="required">*</span></label>
                                <select id="unitNumber" name="unitNumber" required>
                                    <option value="">Select a unit</option>
                                </select>
                                <span class="error-text">Please select a unit</span>
                            </div>
                            <div class="form-group">
                                <label for="moveInDate">Move-in Date <span class="required">*</span></label>
                                <input type="date" id="moveInDate" name="moveInDate" required>
                                <span class="error-text">Please select a move-in date</span>
                            </div>
                            <div class="form-group">
                                <label for="leaseStart">Lease Start Date <span class="required">*</span></label>
                                <input type="date" id="leaseStart" name="leaseStart" required>
                                <span class="error-text">Please select lease start date</span>
                            </div>
                            <div class="form-group">
                                <label for="leaseEnd">Lease End Date <span class="required">*</span></label>
                                <input type="date" id="leaseEnd" name="leaseEnd" required>
                                <span class="error-text">Please select lease end date</span>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-section">
                        <h3 class="section-title">Additional Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="monthlyRent">Monthly Rent (‚Ç±)</label>
                                <input type="number" id="monthlyRent" name="monthlyRent" placeholder="15000">
                            </div>
                            <div class="form-group">
                                <label for="securityDeposit">Security Deposit (‚Ç±)</label>
                                <input type="number" id="securityDeposit" name="securityDeposit" placeholder="30000">
                            </div>
                            <div class="form-group full-width">
                                <label for="notes">Notes (Optional)</label>
                                <input type="text" id="notes" name="notes" placeholder="Any additional information...">
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Create Account</button>
                        <button type="reset" class="btn btn-secondary">Clear Form</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

   <!-- SESSION AUTHENTICATION - MUST BE BEFORE OTHER SCRIPTS -->
   <script>
      (function() {
            function checkAuthentication() {
                const sessionData = localStorage.getItem('rentarium_session');
                
                if (!sessionData) {
                    alert('Please login to access this page');
                    window.location.href = '../Users/Login-Form.html';
                    return null;
                }

                const session = JSON.parse(sessionData);
                
                // Verify admin role
                if (session.role !== 'admin') {
                    alert('Access denied. Admin privileges required.');
                    window.location.href = '../Users/Login-Form.html';
                    return null;
                }

                // Validate 1-hour timeout
                const loginTime = new Date(session.loginTime).getTime();
                const now = Date.now();
                const oneHour = 60 * 60 * 1000;
                
                if ((now - loginTime) >= oneHour) {
                    alert('Your session has expired. Please login again.');
                    localStorage.removeItem('rentarium_session');
                    window.location.href = '../Users/Login-Form.html';
                    return null;
                }

                return session;
            }

            // Run on page load
            const currentSession = checkAuthentication();
            
            if (currentSession) {
                const userNameElement = document.getElementById('userName');
                if (userNameElement) {
                    userNameElement.textContent = currentSession.fullName || currentSession.username;
                }
            }

            // LOGOUT FUNCTIONALITY
            function handleLogout(e) {
                e.preventDefault();
                
                if (confirm('Are you sure you want to logout?')) {
                    // Clear session
                    localStorage.removeItem('rentarium_session');
                    
                    // Log the logout event
                    const logs = JSON.parse(localStorage.getItem('security_logs') || '[]');
                    logs.push({
                        timestamp: new Date().toISOString(),
                        eventType: 'LOGOUT',
                        username: currentSession ? currentSession.username : 'unknown'
                    });
                    localStorage.setItem('security_logs', JSON.stringify(logs));
                    
                    // Redirect to login
                    window.location.href = '../Users/Login-Form.html';
                }
            }
            
            // Attach logout to all logout links
            window.addEventListener('DOMContentLoaded', function() {
                const logoutLinks = document.querySelectorAll('a[href*="Login-Form.html"]');
                logoutLinks.forEach(link => {
                    link.addEventListener('click', handleLogout);
                });
            });

            // Check session on page visibility change
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    checkAuthentication();
                }
            });
        })();
   </script>

   <!-- YOUR EXISTING CREATE TENANT SCRIPT -->
   <script src="../js/create-tenant.js"></script>

   <!-- STORAGE EVENT LISTENER -->
   <script>
    window.addEventListener('storage', () => {
        const tenants = JSON.parse(localStorage.getItem('tenants')) || [];
        // If you have these functions in your create-tenant.js, they'll be available
        if (typeof renderStats === 'function') renderStats();
        if (typeof renderTenants === 'function') renderTenants();
        if (typeof filterTenants === 'function') filterTenants();
        if (typeof populateUnitFilter === 'function') populateUnitFilter();
    });
   </script>
</body> 
</html>